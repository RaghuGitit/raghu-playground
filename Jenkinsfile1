pipeline {
    agent any
    parameters {
        string(name: 'VERSION', defaultValue: '', description: 'version to deploy')
        choice(name: 'VERSION_NBR', choices: ['1.1', '1.2', '1.3'], description: 'version')
        booleanParam(name: 'executeTests', defaultValue: true, description: 'execute test or not')
    }
    environment {
        NEW_VERSION = '1.3.0'
        SERVER_CREDENTIALS = credentials('Cred1') //Cred1 is a Global cred added in Jenkins of kind Username with password
    }
    stages{
        stage("build"){
            //when {
                //expression {
                    //CODE_CHANGES == true
                //}
            //}
            steps{
                echo 'building app..'
                echo "building version ${NEW_VERSION}"
                echo "build number ${BUILD_NUMBER}" //BUILD_NUMBER is a jenkins env var
            }
        }
        stage("test"){
            when {
                expression {
                    (BRANCH_NAME == 'master' || BRANCH_NAME == 'dev') && params.executeTests == true
                }
            }
            steps{
                echo 'testing app..'
            }
        }
        stage("deploy"){
            steps{
                echo 'deploying app..'
                echo "deploying with credentials ${SERVER_CREDENTIALS}"
                echo "deploying with credentials ${params.VERSION_NBR}"
                //withCredentials([
                    //usernamePassword(credentials: 'Cred1', usernameVariable: MYUSER, passwordVariable: MYPWD)
                //]){
                    //User MYUSER and MYPWD for any shell scripts
                //}
            }
        }
    }    
    post{
        always {
            echo 'always - success'
        }
        success{
            echo 'success - success'
        }
        failure{
            echo 'in failure'
        }
    }
}
